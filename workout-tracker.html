<!DOCTYPE html>
<html lang="en">
<!--
    IDGT Fitness - Conditioned To Last
    Version: 9.1
    Last Updated: January 8, 2026
    
    Changelog:
    v9.1 - Improved quick log: auto-adjust date to match selected workout day
    v9.0.1 - Fixed quick log date handling (now properly shows on calendar for correct day)
    v9.0 - Added Quick Actions Menu (floating + button for fast workout logging)
    v8.2 - Added workout reorder feature (drag-and-drop or ‚Üë‚Üì buttons to swap workout days)
    v8.1 - Fixed knee injury dual-mode to work on ANY legs day (not just Wednesday)
    v8.0 - Added HIIT and Cardio as optional workout types (any day can be Strength/HIIT/Cardio/Rest)
    v7.2 - Fixed timezone bug causing calendar dates to be off by 1 day (UTC vs local time)
    v7.1 - Mobile calendar view improvements (fixed background coverage, adjusted spacing)
    v7.0 - Fixed calendar date marking bug (workouts now mark correct day, not just today)
    v6.0 - Calendar improvements (removed today highlighting, monthly goals, click details)
    v5.0 - Fixed favorite toggle bug (preserves set completion)
    v4.0 - Added weight tracking and workout history
    v3.0 - Added workout editing features
    v2.1 - Fixed multi-day workout display bug
    v2.0 - Multi-user profiles with setup wizard + PWA features
    v1.0 - Initial release with core features
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="IDGT Fitness - Your personalized workout tracking app. Conditioned To Last.">
    <meta name="theme-color" content="#FF6B35">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="IDGT Fitness">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>IDGT Fitness - Conditioned To Last</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B35;
            --secondary: #F7931E;
            --dark: #1a1a1a;
            --darker: #0d0d0d;
            --light: #ffffff;
            --gray: #666666;
            --light-gray: #e0e0e0;
            --success: #4CAF50;
            --rest: #9E9E9E;
            --gradient: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--darker);
            color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: var(--dark);
            padding: 30px 0;
            border-bottom: 3px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .profile-selector {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .current-profile {
            background: var(--darker);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid var(--primary);
            color: var(--light);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .current-profile:hover {
            border-color: var(--secondary);
            transform: translateY(-2px);
        }

        .add-profile-btn {
            background: var(--gradient);
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            color: var(--light);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
        }

        .add-profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.4);
        }

        header {
            background: var(--dark);
            padding: 30px 0;
            border-bottom: 3px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            right: -50px;
            width: 200px;
            height: 200px;
            background: var(--gradient);
            opacity: 0.1;
            border-radius: 50%;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.1; }
            50% { transform: scale(1.2); opacity: 0.15; }
        }

        h1 {
            font-family: 'Bebas Neue', cursive;
            font-size: 3.5rem;
            letter-spacing: 3px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            animation: slideIn 0.8s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
            animation: slideIn 0.8s ease-out 0.2s both;
        }

        /* Stats Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
            animation: slideIn 0.8s ease-out 0.4s both;
        }

        .stat-card {
            background: var(--dark);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--gradient);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
        }

        .stat-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 3rem;
            color: var(--primary);
            line-height: 1;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin: 30px 0;
            border-bottom: 2px solid var(--dark);
            animation: slideIn 0.8s ease-out 0.6s both;
        }

        .tab {
            background: transparent;
            border: none;
            color: var(--gray);
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tab:hover {
            color: var(--light);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Weekly Schedule */
        .week-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .day-card {
            background: var(--dark);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid var(--dark);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .day-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .day-card:hover::after {
            transform: scaleX(1);
        }

        .day-card.completed {
            border-color: var(--success);
        }

        .day-card.rest {
            border-color: var(--rest);
            opacity: 0.7;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .day-name {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.8rem;
            letter-spacing: 2px;
        }

        .completion-badge {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid var(--gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .completion-badge.completed {
            background: var(--success);
            border-color: var(--success);
        }

        .muscle-group {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .exercise-list {
            list-style: none;
            margin-top: 10px;
        }

        .exercise-item {
            padding: 8px 0;
            color: var(--gray);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exercise-item::before {
            content: '‚óè';
            color: var(--primary);
        }

        /* Calendar */
        .calendar {
            background: var(--dark);
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .calendar-month {
            font-family: 'Bebas Neue', cursive;
            font-size: 2rem;
            letter-spacing: 2px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day-label {
            text-align: center;
            color: var(--gray);
            font-weight: 700;
            font-size: 0.85rem;
            padding: 10px;
            text-transform: uppercase;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .calendar-day:hover {
            background: rgba(255, 107, 53, 0.1);
        }

        .calendar-day.workout-day {
            background: var(--gradient);
            color: var(--light);
            font-weight: 700;
        }

        .calendar-day.workout-day::after {
            content: '‚úì';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.7rem;
            color: var(--light);
            font-weight: 700;
        }

        /* Workout Type Switcher */
        .workout-type-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .workout-type-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        .workout-type-modal {
            background: var(--dark);
            border-radius: 15px;
            padding: 25px;
            margin-top: 15px;
        }

        .workout-type-options {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }

        .workout-type-option {
            background: var(--darker);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--dark);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .workout-type-option:hover {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .workout-type-option.active {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.2);
        }

        .workout-type-icon {
            font-size: 2rem;
            min-width: 40px;
            text-align: center;
        }

        .workout-type-info {
            flex: 1;
        }

        .workout-type-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--light);
            margin-bottom: 5px;
        }

        .workout-type-desc {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .hiit-badge {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            color: var(--light);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            display: inline-block;
        }

        .cardio-badge {
            background: #4CAF50;
            color: var(--light);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            display: inline-block;
        }

        /* HIIT/Cardio specific styles */
        .rounds-tracker {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .round-box {
            flex: 1;
            min-width: 80px;
            padding: 12px;
            background: var(--dark);
            border: 2px solid var(--gray);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .round-box:hover {
            border-color: var(--primary);
        }

        .round-box.completed {
            background: var(--gradient);
            color: var(--light);
            border-color: var(--primary);
        }

        .duration-input {
            width: 100%;
            padding: 12px;
            background: var(--dark);
            border: 2px solid var(--gray);
            border-radius: 8px;
            color: var(--light);
            font-size: 1rem;
            margin-top: 10px;
        }

        .duration-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Workout Reorder Modal */
        .reorder-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .reorder-item {
            background: var(--darker);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--dark);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .reorder-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .reorder-handle {
            font-size: 1.5rem;
            cursor: grab;
            color: var(--gray);
            min-width: 30px;
            text-align: center;
        }

        .reorder-handle:active {
            cursor: grabbing;
        }

        .reorder-info {
            flex: 1;
        }

        .reorder-day-name {
            font-weight: 700;
            font-size: 1rem;
            color: var(--light);
        }

        .reorder-workout-type {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 3px;
        }

        .reorder-controls {
            display: flex;
            gap: 8px;
        }

        .reorder-btn {
            background: var(--dark);
            border: 2px solid var(--gray);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .reorder-btn:hover {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .reorder-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .reorder-header-btn {
            background: none;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-left: auto;
        }

        .reorder-header-btn:hover {
            background: var(--secondary);
            color: var(--darker);
        }

        /* Quick Actions Menu */
        .quick-actions-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient);
            border: none;
            font-size: 2rem;
            color: var(--light);
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quick-actions-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(255, 107, 53, 0.6);
        }

        .quick-actions-btn.active {
            transform: rotate(45deg);
        }

        .quick-actions-menu {
            position: fixed;
            bottom: 100px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .quick-actions-menu.active {
            opacity: 1;
            pointer-events: all;
            bottom: 110px;
        }

        .quick-action-item {
            background: var(--dark);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .quick-action-item:hover {
            background: rgba(255, 107, 53, 0.1);
            transform: translateX(-5px);
        }

        .quick-action-icon {
            font-size: 1.5rem;
            min-width: 30px;
            text-align: center;
        }

        .quick-action-label {
            font-weight: 600;
            color: var(--light);
        }

        /* Quick Log Modal */
        .quick-log-grid {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }

        .quick-log-day {
            background: var(--darker);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--dark);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-log-day:hover {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .quick-log-day-name {
            font-weight: 700;
            color: var(--light);
            margin-bottom: 5px;
        }

        .quick-log-workout {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 12px;
            background: var(--darker);
            border-radius: 8px;
        }

        .date-selector input {
            flex: 1;
            padding: 8px;
            background: var(--dark);
            border: 2px solid var(--gray);
            border-radius: 6px;
            color: var(--light);
            font-size: 1rem;
        }

        .date-selector input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .calendar-day.rest-day {
            background: var(--rest);
            color: var(--light);
        }

        /* Workout Detail Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 2px solid var(--primary);
            animation: slideIn 0.3s ease-out;
        }

        /* Setup Wizard */
        .wizard-step {
            display: none;
        }

        .wizard-step.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .wizard-input {
            width: 100%;
            padding: 15px;
            background: var(--darker);
            border: 2px solid var(--gray);
            border-radius: 10px;
            color: var(--light);
            font-size: 1rem;
            margin: 15px 0;
            font-family: 'DM Sans', sans-serif;
            transition: border-color 0.3s ease;
        }

        .wizard-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .wizard-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .wizard-option {
            background: var(--darker);
            border: 2px solid var(--gray);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
        }

        .wizard-option:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .wizard-option.selected {
            border-color: var(--primary);
            background: var(--gradient);
        }

        .wizard-days {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .wizard-day {
            background: var(--darker);
            border: 2px solid var(--gray);
            border-radius: 10px;
            padding: 15px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .wizard-day:hover {
            border-color: var(--primary);
        }

        .wizard-day.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: var(--light);
        }

        .wizard-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .wizard-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
        }

        .wizard-btn-next {
            background: var(--gradient);
            color: var(--light);
        }

        .wizard-btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.4);
        }

        .wizard-btn-back {
            background: var(--darker);
            color: var(--light);
            border: 2px solid var(--gray);
        }

        .wizard-btn-back:hover {
            border-color: var(--primary);
        }

        .wizard-progress {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .progress-dot {
            flex: 1;
            height: 4px;
            background: var(--gray);
            border-radius: 2px;
            transition: background 0.3s ease;
        }

        .progress-dot.active {
            background: var(--gradient);
        }

        .profile-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .profile-item {
            background: var(--darker);
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .profile-item.active {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .profile-details {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .delete-profile-btn {
            background: none;
            border: 2px solid var(--gray);
            color: var(--gray);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .delete-profile-btn:hover {
            border-color: #f44336;
            color: #f44336;
        }

        /* Edit Workout Interface */
        .edit-mode-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--dark);
        }

        .edit-btn {
            background: none;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
        }

        .edit-btn:hover {
            background: var(--primary);
            color: var(--light);
        }

        .edit-btn.active {
            background: var(--primary);
            color: var(--light);
        }

        .exercise-edit-controls {
            display: none;
            margin-top: 10px;
            gap: 10px;
        }

        .exercise-edit-controls.active {
            display: flex;
        }

        .edit-input {
            flex: 1;
            padding: 8px 12px;
            background: var(--dark);
            border: 2px solid var(--gray);
            border-radius: 6px;
            color: var(--light);
            font-size: 0.9rem;
            font-family: 'DM Sans', sans-serif;
        }

        .edit-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .delete-exercise-btn {
            background: none;
            border: 2px solid #f44336;
            color: #f44336;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .delete-exercise-btn:hover {
            background: #f44336;
            color: var(--light);
        }

        .add-exercise-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: var(--dark);
            border-radius: 10px;
            border: 2px dashed var(--gray);
        }

        .add-exercise-section.active {
            display: block;
        }

        .add-exercise-form {
            display: grid;
            gap: 15px;
        }

        .add-exercise-form input {
            padding: 12px;
            background: var(--darker);
            border: 2px solid var(--gray);
            border-radius: 8px;
            color: var(--light);
            font-size: 1rem;
            font-family: 'DM Sans', sans-serif;
        }

        .add-exercise-form input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .add-exercise-btns {
            display: flex;
            gap: 10px;
        }

        /* Weight Tracking */
        .weight-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .weight-input {
            width: 80px;
            padding: 8px;
            background: var(--dark);
            border: 2px solid var(--gray);
            border-radius: 6px;
            color: var(--light);
            font-size: 0.9rem;
            text-align: center;
            font-family: 'DM Sans', sans-serif;
        }

        .weight-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .weight-label {
            color: var(--gray);
            font-size: 0.85rem;
            font-weight: 600;
        }

        .last-weight {
            color: var(--secondary);
            font-size: 0.85rem;
            font-style: italic;
        }

        .set-box.logged {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.3) 0%, rgba(247, 147, 30, 0.3) 100%);
            border-color: var(--primary);
        }

        /* Workout History */
        .history-section {
            background: var(--dark);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .history-title {
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-entry {
            background: var(--darker);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary);
        }

        .history-date {
            color: var(--secondary);
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .history-exercise {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            color: var(--light);
            font-size: 0.95rem;
        }

        .history-exercise-name {
            flex: 1;
        }

        .history-sets {
            color: var(--gray);
            font-size: 0.85rem;
        }

        .history-weight {
            color: var(--primary);
            font-weight: 700;
            margin-left: 15px;
        }

        .no-history {
            text-align: center;
            color: var(--gray);
            padding: 30px;
            font-style: italic;
        }

        .view-history-btn {
            background: none;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            padding: 6px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .view-history-btn:hover {
            background: var(--secondary);
            color: var(--dark);
        }

        /* Monthly Goals */
        .monthly-goals {
            background: var(--dark);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid var(--primary);
        }

        .goals-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .goals-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.5rem;
            letter-spacing: 1px;
            color: var(--primary);
        }

        .goal-target {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .goal-input {
            width: 60px;
            padding: 8px;
            background: var(--darker);
            border: 2px solid var(--gray);
            border-radius: 6px;
            color: var(--light);
            text-align: center;
            font-weight: 700;
            font-size: 1rem;
        }

        .goal-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .progress-container {
            background: var(--darker);
            border-radius: 10px;
            padding: 15px;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .progress-current {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .progress-target {
            color: var(--gray);
        }

        .progress-bar-container {
            width: 100%;
            height: 20px;
            background: var(--dark);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--gradient);
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: var(--light);
            font-weight: 700;
            font-size: 0.85rem;
        }

        .progress-message {
            margin-top: 15px;
            text-align: center;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .progress-message.on-track {
            color: var(--success);
        }

        .progress-message.behind {
            color: var(--secondary);
        }

        .progress-message.crushing {
            color: var(--primary);
            font-size: 1.1rem;
        }

        /* Calendar Day Detail Modal */
        .calendar-day-detail {
            background: var(--darker);
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .day-detail-header {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--dark);
        }

        .day-detail-workout {
            background: var(--dark);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .day-detail-muscle {
            color: var(--secondary);
            font-weight: 700;
            margin-bottom: 10px;
        }

        .day-detail-exercise {
            padding: 5px 0;
            color: var(--light);
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
        }

        .calendar-day.clickable {
            cursor: pointer;
        }

        .calendar-day.clickable:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        /* Workout Detail Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 2px solid var(--primary);
            animation: slideIn 0.3s ease-out;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--light);
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--primary);
        }

        .modal-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 2.5rem;
            letter-spacing: 2px;
            margin-bottom: 10px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .exercise-detail {
            background: var(--darker);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .exercise-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .favorite-btn {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .favorite-btn.active,
        .favorite-btn:hover {
            color: var(--secondary);
            transform: scale(1.2);
        }

        .sets-tracker {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .set-box {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--gray);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
        }

        .set-box:hover {
            border-color: var(--primary);
        }

        .set-box.completed {
            background: var(--success);
            border-color: var(--success);
            color: var(--light);
        }

        .complete-workout-btn {
            width: 100%;
            padding: 18px;
            background: var(--gradient);
            border: none;
            border-radius: 10px;
            color: var(--light);
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 25px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'DM Sans', sans-serif;
        }

        .complete-workout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4);
        }

        /* Favorites */
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .favorite-card {
            background: var(--dark);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--dark);
            transition: all 0.3s ease;
        }

        .favorite-card:hover {
            border-color: var(--secondary);
            transform: translateY(-3px);
        }

        .favorite-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .favorite-name {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .remove-favorite {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }

        .remove-favorite:hover {
            color: var(--primary);
        }

        /* Mode Toggle */
        .mode-toggle {
            display: inline-flex;
            background: var(--darker);
            border-radius: 8px;
            padding: 4px;
            margin-top: 10px;
            border: 1px solid var(--gray);
        }

        .mode-option {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: var(--gray);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 600;
            font-family: 'DM Sans', sans-serif;
        }

        .mode-option.active {
            background: var(--gradient);
            color: var(--light);
        }

        .mode-option:hover:not(.active) {
            color: var(--light);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 2.5rem;
            }

            .week-grid,
            .favorites-grid {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 2.5rem;
            }

            .modal-content {
                padding: 30px 20px;
            }

            /* Calendar mobile fixes */
            .calendar {
                padding: 15px;
                border-radius: 10px;
            }

            .calendar-header {
                flex-direction: column;
                gap: 15px;
                margin-bottom: 20px;
            }

            .calendar-month {
                font-size: 1.5rem;
            }

            .calendar-grid {
                gap: 5px;
            }

            .calendar-day-label {
                font-size: 0.7rem;
                padding: 5px;
            }

            .calendar-day {
                border-radius: 8px;
                font-size: 0.9rem;
            }

            .calendar-day.workout-day::after {
                font-size: 0.6rem;
                top: 1px;
                right: 1px;
            }

            /* Monthly goals mobile */
            .monthly-goals {
                padding: 15px;
            }

            .goals-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .goals-title {
                font-size: 1.3rem;
            }

            .goal-input {
                width: 50px;
                font-size: 0.9rem;
            }

            /* Calendar day detail mobile */
            .calendar-day-detail {
                padding: 15px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--darker);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1>IDGT FITNESS</h1>
                    <p class="subtitle">Conditioned To Last</p>
                </div>
                <div class="profile-selector">
                    <div class="current-profile" onclick="openProfileSelector()">
                        <span>üë§</span>
                        <span id="currentProfileName">Loading...</span>
                    </div>
                    <button class="add-profile-btn" onclick="openSetupWizard()">+ New Profile</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Stats Section -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="monthWorkouts">0</div>
                <div class="stat-label">Workouts This Month</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="currentStreak">0</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completionRate">0%</div>
                <div class="stat-label">Completion Rate</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('schedule')">Weekly Schedule</button>
            <button class="tab" onclick="switchTab('calendar')">Monthly Calendar</button>
            <button class="tab" onclick="switchTab('history')">History</button>
            <button class="tab" onclick="switchTab('favorites')">Favorites</button>
        </div>

        <!-- Tab Content -->
        <div id="schedule-content" class="tab-content active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-family: 'Bebas Neue', cursive; font-size: 1.5rem; letter-spacing: 1px; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">This Week</h2>
                <button class="reorder-header-btn" onclick="openReorderModal()">üîÑ Reorder Workouts</button>
            </div>
            <div class="week-grid" id="weekGrid"></div>
        </div>

        <div id="calendar-content" class="tab-content">
            <!-- Monthly Goals -->
            <div class="monthly-goals">
                <div class="goals-header">
                    <div class="goals-title">Monthly Goal</div>
                    <div class="goal-target">
                        <span style="color: var(--gray); font-size: 0.9rem;">Target:</span>
                        <input type="number" class="goal-input" id="monthlyGoal" value="20" min="1" max="31" onchange="updateMonthlyGoal()">
                        <span style="color: var(--gray); font-size: 0.9rem;">workouts</span>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-stats">
                        <span class="progress-current" id="goalProgress">0 / 20</span>
                        <span class="progress-target" id="goalPercentage">0%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progressBar" style="width: 0%">
                            <span id="progressBarText"></span>
                        </div>
                    </div>
                    <div class="progress-message" id="progressMessage"></div>
                </div>
            </div>

            <div class="calendar">
                <div class="calendar-header">
                    <button class="tab" onclick="changeMonth(-1)">‚Üê Prev</button>
                    <div class="calendar-month" id="calendarMonth"></div>
                    <button class="tab" onclick="changeMonth(1)">Next ‚Üí</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>

            <!-- Calendar Day Detail -->
            <div id="calendarDayDetail"></div>
        </div>

        <div id="favorites-content" class="tab-content">
            <div class="favorites-grid" id="favoritesGrid"></div>
        </div>

        <div id="history-content" class="tab-content">
            <div id="historyContainer"></div>
        </div>
    </div>

    <!-- Quick Actions Floating Button -->
    <button class="quick-actions-btn" id="quickActionsBtn" onclick="toggleQuickActions()">+</button>
    
    <div class="quick-actions-menu" id="quickActionsMenu">
        <div class="quick-action-item" onclick="quickLogToday()">
            <div class="quick-action-icon">‚úÖ</div>
            <div class="quick-action-label">Log Today's Workout</div>
        </div>
        <div class="quick-action-item" onclick="quickLogYesterday()">
            <div class="quick-action-icon">üìÖ</div>
            <div class="quick-action-label">Log Yesterday's Workout</div>
        </div>
        <div class="quick-action-item" onclick="openSkipWorkoutModal()">
            <div class="quick-action-icon">‚è≠Ô∏è</div>
            <div class="quick-action-label">Skip Today's Workout</div>
        </div>
        <div class="quick-action-item" onclick="openCustomWorkoutModal()">
            <div class="quick-action-icon">‚ûï</div>
            <div class="quick-action-label">Add Custom Workout</div>
        </div>
    </div>

    <!-- Workout Detail Modal -->
    <div class="modal" id="workoutModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <div class="edit-mode-toggle">
                <div class="modal-title" id="modalTitle"></div>
                <button class="edit-btn" id="editToggleBtn" onclick="toggleEditMode()">Edit Workout</button>
            </div>
            <div id="modalExercises"></div>
            <div class="add-exercise-section" id="addExerciseSection">
                <h4 style="color: var(--primary); margin-bottom: 15px;">Add New Exercise</h4>
                <div class="add-exercise-form">
                    <input type="text" id="newExerciseName" placeholder="Exercise name (e.g., Bench Press)">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="number" id="newExerciseSets" placeholder="Sets" value="3" min="1">
                        <input type="text" id="newExerciseReps" placeholder="Reps (e.g., 10-12)" value="10-12">
                    </div>
                    <div class="add-exercise-btns">
                        <button class="wizard-btn wizard-btn-next" style="flex: 1;" onclick="addExercise()">Add Exercise</button>
                        <button class="wizard-btn wizard-btn-back" onclick="cancelAddExercise()">Cancel</button>
                    </div>
                </div>
            </div>
            <button class="complete-workout-btn" onclick="completeWorkout()">Complete Workout</button>
        </div>
    </div>

    <!-- Workout Type Selector Modal -->
    <div class="modal" id="workoutTypeModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeWorkoutTypeModal()">√ó</button>
            <div class="modal-title">Change Workout Type</div>
            <p style="color: var(--gray); margin: 15px 0;">Choose a different workout type for <span id="workoutTypeDayName"></span></p>
            
            <div class="workout-type-options">
                <div class="workout-type-option" onclick="switchWorkoutType('strength')">
                    <div class="workout-type-icon">üí™</div>
                    <div class="workout-type-info">
                        <div class="workout-type-name">Strength Training</div>
                        <div class="workout-type-desc">Your original workout plan</div>
                    </div>
                </div>
                
                <div class="workout-type-option" onclick="switchWorkoutType('hiit')">
                    <div class="workout-type-icon">üî•</div>
                    <div class="workout-type-info">
                        <div class="workout-type-name">HIIT Circuit</div>
                        <div class="workout-type-desc">High-intensity intervals, bodyweight focus</div>
                    </div>
                </div>
                
                <div class="workout-type-option" onclick="switchWorkoutType('cardio')">
                    <div class="workout-type-icon">üèÉ</div>
                    <div class="workout-type-info">
                        <div class="workout-type-name">Cardio</div>
                        <div class="workout-type-desc">Steady-state endurance training</div>
                    </div>
                </div>
                
                <div class="workout-type-option" onclick="switchWorkoutType('rest')">
                    <div class="workout-type-icon">üò¥</div>
                    <div class="workout-type-info">
                        <div class="workout-type-name">Rest Day</div>
                        <div class="workout-type-desc">Recovery and muscle rebuilding</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Workout Reorder Modal -->
    <div class="modal" id="reorderModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeReorderModal()">√ó</button>
            <div class="modal-title">Reorder Workouts</div>
            <p style="color: var(--gray); margin: 15px 0;">Rearrange which workout is assigned to each day. Days stay fixed, workouts move.</p>
            
            <div class="reorder-list" id="reorderList"></div>
            
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button class="wizard-btn wizard-btn-next" style="flex: 1;" onclick="applyReorder()">Apply Changes</button>
                <button class="wizard-btn wizard-btn-back" onclick="closeReorderModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Quick Log Modal -->
    <div class="modal" id="quickLogModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeQuickLogModal()">√ó</button>
            <div class="modal-title" id="quickLogTitle">Log Workout</div>
            
            <div class="date-selector">
                <span style="color: var(--gray);">Date:</span>
                <input type="date" id="quickLogDate" onchange="updateQuickLogDateDisplay()" />
                <button class="wizard-btn wizard-btn-back" style="padding: 8px 15px; margin: 0;" onclick="adjustQuickLogDate(-7)">‚Üê Week</button>
                <button class="wizard-btn wizard-btn-back" style="padding: 8px 15px; margin: 0;" onclick="adjustQuickLogDate(7)">Week ‚Üí</button>
            </div>
            
            <p style="color: var(--gray); margin: 15px 0;">Select which workout you completed on <span id="quickLogDateDisplay" style="color: var(--primary); font-weight: 700;"></span>:</p>
            
            <div class="quick-log-grid" id="quickLogGrid"></div>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--dark);" id="quickLogSelectedWorkout"></div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="wizard-btn wizard-btn-next" style="flex: 1;" id="quickLogConfirmBtn" onclick="confirmQuickLog()" disabled>Log Workout</button>
                <button class="wizard-btn wizard-btn-back" onclick="closeQuickLogModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Custom Workout Modal -->
    <div class="modal" id="customWorkoutModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeCustomWorkoutModal()">√ó</button>
            <div class="modal-title">Add Custom Workout</div>
            
            <div class="date-selector">
                <span style="color: var(--gray);">Date:</span>
                <input type="date" id="customWorkoutDate" />
            </div>
            
            <div style="margin: 20px 0;">
                <label style="color: var(--gray); display: block; margin-bottom: 8px;">Workout Name:</label>
                <input type="text" id="customWorkoutName" placeholder="e.g., Morning Run, Yoga Session" 
                       style="width: 100%; padding: 12px; background: var(--dark); border: 2px solid var(--gray); border-radius: 8px; color: var(--light); font-size: 1rem;">
            </div>
            
            <div style="margin: 20px 0;">
                <label style="color: var(--gray); display: block; margin-bottom: 8px;">Notes (optional):</label>
                <textarea id="customWorkoutNotes" placeholder="Add any notes about this workout..." 
                          style="width: 100%; padding: 12px; background: var(--dark); border: 2px solid var(--gray); border-radius: 8px; color: var(--light); font-size: 1rem; min-height: 80px; resize: vertical;"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button class="wizard-btn wizard-btn-next" style="flex: 1;" onclick="saveCustomWorkout()">Log Workout</button>
                <button class="wizard-btn wizard-btn-back" onclick="closeCustomWorkoutModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Setup Wizard Modal -->
    <div class="modal" id="setupWizard">
        <div class="modal-content">
            <button class="modal-close" onclick="closeSetupWizard()">√ó</button>
            
            <div class="wizard-progress">
                <div class="progress-dot active" id="progress-0"></div>
                <div class="progress-dot" id="progress-1"></div>
                <div class="progress-dot" id="progress-2"></div>
                <div class="progress-dot" id="progress-3"></div>
                <div class="progress-dot" id="progress-4"></div>
            </div>

            <!-- Step 1: Name -->
            <div class="wizard-step active" id="step-0">
                <div class="modal-title">Welcome to IDGT Fitness!</div>
                <p style="color: var(--gray); margin: 15px 0;">Let's create your personalized workout plan</p>
                <input type="text" class="wizard-input" id="profileName" placeholder="Enter your name" />
                <div class="wizard-buttons">
                    <button class="wizard-btn wizard-btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 2: Injuries -->
            <div class="wizard-step" id="step-1">
                <div class="modal-title">Any Injuries?</div>
                <p style="color: var(--gray); margin: 15px 0;">We'll customize your workouts accordingly</p>
                <div class="wizard-options">
                    <div class="wizard-option" onclick="selectInjury('none')">
                        <div style="font-size: 2rem; margin-bottom: 10px;">üí™</div>
                        <div>No Injuries</div>
                    </div>
                    <div class="wizard-option" onclick="selectInjury('knee')">
                        <div style="font-size: 2rem; margin-bottom: 10px;">ü¶µ</div>
                        <div>Knee/ACL</div>
                    </div>
                    <div class="wizard-option" onclick="selectInjury('shoulder')">
                        <div style="font-size: 2rem; margin-bottom: 10px;">üí™</div>
                        <div>Shoulder</div>
                    </div>
                    <div class="wizard-option" onclick="selectInjury('back')">
                        <div style="font-size: 2rem; margin-bottom: 10px;">üßò</div>
                        <div>Back</div>
                    </div>
                </div>
                <div class="wizard-buttons">
                    <button class="wizard-btn wizard-btn-back" onclick="prevStep()">Back</button>
                    <button class="wizard-btn wizard-btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 3: Workout Days -->
            <div class="wizard-step" id="step-2">
                <div class="modal-title">Which Days Do You Work Out?</div>
                <p style="color: var(--gray); margin: 15px 0;">Select your preferred workout days</p>
                <div class="wizard-days">
                    <div class="wizard-day" onclick="toggleDay('monday')">Mon</div>
                    <div class="wizard-day" onclick="toggleDay('tuesday')">Tue</div>
                    <div class="wizard-day" onclick="toggleDay('wednesday')">Wed</div>
                    <div class="wizard-day" onclick="toggleDay('thursday')">Thu</div>
                    <div class="wizard-day" onclick="toggleDay('friday')">Fri</div>
                    <div class="wizard-day" onclick="toggleDay('saturday')">Sat</div>
                    <div class="wizard-day" onclick="toggleDay('sunday')">Sun</div>
                </div>
                <div class="wizard-buttons">
                    <button class="wizard-btn wizard-btn-back" onclick="prevStep()">Back</button>
                    <button class="wizard-btn wizard-btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 4: Workout Split -->
            <div class="wizard-step" id="step-3">
                <div class="modal-title">Choose Your Split</div>
                <p style="color: var(--gray); margin: 15px 0;">How do you want to organize your workouts?</p>
                <div class="wizard-options">
                    <div class="wizard-option" onclick="selectSplit('push-pull-legs')">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">üí™üî•</div>
                        <div style="margin-bottom: 5px; font-weight: 700;">Push/Pull/Legs</div>
                        <div style="font-size: 0.8rem; color: var(--gray);">3-6 day split</div>
                    </div>
                    <div class="wizard-option" onclick="selectSplit('upper-lower')">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">‚¨ÜÔ∏è‚¨áÔ∏è</div>
                        <div style="margin-bottom: 5px; font-weight: 700;">Upper/Lower</div>
                        <div style="font-size: 0.8rem; color: var(--gray);">4 day split</div>
                    </div>
                    <div class="wizard-option" onclick="selectSplit('body-part')">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">üéØ</div>
                        <div style="margin-bottom: 5px; font-weight: 700;">Body Part Split</div>
                        <div style="font-size: 0.8rem; color: var(--gray);">5-6 day split</div>
                    </div>
                    <div class="wizard-option" onclick="selectSplit('full-body')">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">üèãÔ∏è</div>
                        <div style="margin-bottom: 5px; font-weight: 700;">Full Body</div>
                        <div style="font-size: 0.8rem; color: var(--gray);">2-3 day split</div>
                    </div>
                </div>
                <div class="wizard-buttons">
                    <button class="wizard-btn wizard-btn-back" onclick="prevStep()">Back</button>
                    <button class="wizard-btn wizard-btn-next" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 5: Summary -->
            <div class="wizard-step" id="step-4">
                <div class="modal-title">All Set!</div>
                <p style="color: var(--gray); margin: 15px 0;">Here's your personalized plan:</p>
                <div style="background: var(--darker); padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <div style="margin-bottom: 15px;">
                        <strong style="color: var(--primary);">Name:</strong>
                        <span id="summaryName" style="margin-left: 10px;"></span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong style="color: var(--primary);">Injury Status:</strong>
                        <span id="summaryInjury" style="margin-left: 10px;"></span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong style="color: var(--primary);">Workout Days:</strong>
                        <span id="summaryDays" style="margin-left: 10px;"></span>
                    </div>
                    <div>
                        <strong style="color: var(--primary);">Split Type:</strong>
                        <span id="summarySplit" style="margin-left: 10px;"></span>
                    </div>
                </div>
                <div class="wizard-buttons">
                    <button class="wizard-btn wizard-btn-back" onclick="prevStep()">Back</button>
                    <button class="wizard-btn wizard-btn-next" onclick="createProfile()">Create Profile</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Selector Modal -->
    <div class="modal" id="profileSelector">
        <div class="modal-content">
            <button class="modal-close" onclick="closeProfileSelector()">√ó</button>
            <div class="modal-title">Select Profile</div>
            <div class="profile-list" id="profileList"></div>
        </div>
    </div>

    <script>
        // Profile and workout plan generation
        let profiles = JSON.parse(localStorage.getItem('profiles')) || [];
        let currentProfileId = localStorage.getItem('currentProfileId');
        let wizardData = {
            step: 0,
            name: '',
            injury: 'none',
            workoutDays: [],
            split: ''
        };

        // Workout data structure (keeping your original as template)
        const workoutPlan = {
            monday: {
                name: 'Monday',
                muscleGroup: 'Chest & Triceps',
                exercises: [
                    { name: 'Bench Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Incline Dumbbell Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Cable Flyes', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Tricep Pushdowns', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Overhead Tricep Extension', sets: 3, reps: '10-12', weight: 0, favorite: false }
                ]
            },
            tuesday: {
                name: 'Tuesday',
                muscleGroup: 'Back & Biceps',
                exercises: [
                    { name: 'Pull-ups/Lat Pulldown', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Bent Over Rows', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Seated Cable Rows', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Barbell Curls', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Hammer Curls', sets: 3, reps: '10-12', weight: 0, favorite: false }
                ]
            },
            wednesday: {
                name: 'Wednesday',
                muscleGroup: 'Legs (ACL-Safe)',
                mode: 'legs', // 'legs' or 'cardio'
                legs: {
                    exercises: [
                        { name: 'Bodyweight Squats', sets: 3, reps: '10-12', weight: 0, favorite: false },
                        { name: 'Leg Curls (Light)', sets: 3, reps: '10-12', weight: 0, favorite: false },
                        { name: 'Calf Raises', sets: 3, reps: '10-12', weight: 0, favorite: false },
                        { name: 'Glute Bridges', sets: 3, reps: '10-12', weight: 0, favorite: false },
                        { name: 'Straight Leg Raises', sets: 3, reps: '10-12', weight: 0, favorite: false }
                    ],
                    warning: '‚ö†Ô∏è Light weights only - ACL recovery'
                },
                cardio: {
                    exercises: [
                        { name: 'Stationary Bike', sets: 1, reps: '20-30 min', weight: 0, favorite: false },
                        { name: 'Elliptical', sets: 1, reps: '20-30 min', weight: 0, favorite: false },
                        { name: 'Swimming', sets: 1, reps: '20-30 min', weight: 0, favorite: false },
                        { name: 'Walking/Light Jog', sets: 1, reps: '20-30 min', weight: 0, favorite: false },
                        { name: 'Rowing Machine', sets: 1, reps: '15-20 min', weight: 0, favorite: false }
                    ],
                    warning: '‚ö†Ô∏è Low-impact cardio - ACL friendly'
                }
            },
            thursday: {
                name: 'Thursday',
                muscleGroup: 'Shoulders & Arms',
                exercises: [
                    { name: 'Overhead Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Lateral Raises', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Front Raises', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Face Pulls', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Dumbbell Shrugs', sets: 3, reps: '10-12', weight: 0, favorite: false }
                ]
            },
            friday: {
                name: 'Friday',
                muscleGroup: 'Rest Day',
                rest: true
            },
            saturday: {
                name: 'Saturday',
                muscleGroup: 'Full Body',
                exercises: [
                    { name: 'Push-ups', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Dumbbell Rows', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Bodyweight Squats', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Shoulder Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Plank', sets: 3, reps: '30-60s', weight: 0, favorite: false }
                ]
            },
            sunday: {
                name: 'Sunday',
                muscleGroup: 'Optional Rest',
                rest: true
            }
        };

        // Load saved data
        let workoutData = {};
        let completedWorkouts = {};
        let currentWorkout = null;
        let currentDate = new Date();
        let isEditMode = false;
        let monthlyGoal = 20; // Default goal

        // Initialize
        function init() {
            // Check if we have profiles
            if (profiles.length === 0) {
                // First time user - open setup wizard
                openSetupWizard();
            } else {
                // Load current profile or default to first
                if (!currentProfileId || !profiles.find(p => p.id === currentProfileId)) {
                    currentProfileId = profiles[0].id;
                    localStorage.setItem('currentProfileId', currentProfileId);
                }
                loadProfile(currentProfileId);
            }
        }

        // Load Profile
        function loadProfile(profileId) {
            const profile = profiles.find(p => p.id === profileId);
            if (!profile) return;

            currentProfileId = profileId;
            localStorage.setItem('currentProfileId', profileId);

            workoutData = profile.workoutData;
            completedWorkouts = profile.completedWorkouts || {};
            monthlyGoal = profile.monthlyGoal || 20;

            document.getElementById('currentProfileName').textContent = profile.name;
            
            // Update monthly goal input if it exists
            const goalInput = document.getElementById('monthlyGoal');
            if (goalInput) {
                goalInput.value = monthlyGoal;
            }

            renderWeeklySchedule();
            renderCalendar();
            renderFavorites();
            updateStats();
        }

        // Setup Wizard Functions
        function openSetupWizard() {
            wizardData = { step: 0, name: '', injury: 'none', workoutDays: [], split: '' };
            document.getElementById('setupWizard').classList.add('active');
            showStep(0);
        }

        function closeSetupWizard() {
            document.getElementById('setupWizard').classList.remove('active');
        }

        function showStep(stepNum) {
            document.querySelectorAll('.wizard-step').forEach(step => step.classList.remove('active'));
            document.getElementById(`step-${stepNum}`).classList.add('active');
            
            document.querySelectorAll('.progress-dot').forEach((dot, idx) => {
                dot.classList.toggle('active', idx <= stepNum);
            });

            wizardData.step = stepNum;

            // Restore visual state when showing step 2 (workout days)
            if (stepNum === 2) {
                document.querySelectorAll('.wizard-day').forEach(dayEl => {
                    const dayText = dayEl.textContent.toLowerCase();
                    const dayMap = {
                        'mon': 'monday',
                        'tue': 'tuesday', 
                        'wed': 'wednesday',
                        'thu': 'thursday',
                        'fri': 'friday',
                        'sat': 'saturday',
                        'sun': 'sunday'
                    };
                    const fullDay = dayMap[dayText];
                    if (wizardData.workoutDays.includes(fullDay)) {
                        dayEl.classList.add('selected');
                    } else {
                        dayEl.classList.remove('selected');
                    }
                });
            }

            // Restore visual state when showing step 1 (injury)
            if (stepNum === 1) {
                document.querySelectorAll('#step-1 .wizard-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                // Re-select the current injury option if one is set
                if (wizardData.injury) {
                    const injuryOptions = document.querySelectorAll('#step-1 .wizard-option');
                    const injuryIndex = ['none', 'knee', 'shoulder', 'back'].indexOf(wizardData.injury);
                    if (injuryIndex > -1 && injuryOptions[injuryIndex]) {
                        injuryOptions[injuryIndex].classList.add('selected');
                    }
                }
            }

            // Restore visual state when showing step 3 (split)
            if (stepNum === 3) {
                document.querySelectorAll('#step-3 .wizard-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                // Re-select the current split option if one is set
                if (wizardData.split) {
                    const splitOptions = document.querySelectorAll('#step-3 .wizard-option');
                    const splitIndex = ['push-pull-legs', 'upper-lower', 'body-part', 'full-body'].indexOf(wizardData.split);
                    if (splitIndex > -1 && splitOptions[splitIndex]) {
                        splitOptions[splitIndex].classList.add('selected');
                    }
                }
            }

            // Update summary if on last step
            if (stepNum === 4) {
                document.getElementById('summaryName').textContent = wizardData.name;
                document.getElementById('summaryInjury').textContent = 
                    wizardData.injury === 'none' ? 'No injuries' : 
                    wizardData.injury.charAt(0).toUpperCase() + wizardData.injury.slice(1) + ' injury';
                document.getElementById('summaryDays').textContent = 
                    wizardData.workoutDays.map(d => d.charAt(0).toUpperCase() + d.slice(1)).join(', ');
                document.getElementById('summarySplit').textContent = 
                    wizardData.split === 'push-pull-legs' ? 'Push/Pull/Legs' :
                    wizardData.split === 'upper-lower' ? 'Upper/Lower' :
                    wizardData.split === 'body-part' ? 'Body Part Split' : 'Full Body';
            }
        }

        function nextStep() {
            const currentStep = wizardData.step;

            // Validation
            if (currentStep === 0) {
                const name = document.getElementById('profileName').value.trim();
                if (!name) {
                    alert('Please enter your name');
                    return;
                }
                wizardData.name = name;
            } else if (currentStep === 2 && wizardData.workoutDays.length === 0) {
                alert('Please select at least one workout day');
                return;
            } else if (currentStep === 3 && !wizardData.split) {
                alert('Please select a workout split');
                return;
            }

            showStep(currentStep + 1);
        }

        function prevStep() {
            showStep(wizardData.step - 1);
        }

        function selectInjury(injury) {
            wizardData.injury = injury;
            document.querySelectorAll('#step-1 .wizard-option').forEach(opt => opt.classList.remove('selected'));
            event.target.closest('.wizard-option').classList.add('selected');
        }

        function toggleDay(day) {
            const dayElement = event.target;
            const index = wizardData.workoutDays.indexOf(day);
            
            if (index > -1) {
                wizardData.workoutDays.splice(index, 1);
                dayElement.classList.remove('selected');
            } else {
                wizardData.workoutDays.push(day);
                dayElement.classList.add('selected');
            }
        }

        function selectSplit(split) {
            wizardData.split = split;
            document.querySelectorAll('#step-3 .wizard-option').forEach(opt => opt.classList.remove('selected'));
            event.target.closest('.wizard-option').classList.add('selected');
        }

        function createProfile() {
            console.log('Creating profile with data:', wizardData);
            console.log('Workout days selected:', wizardData.workoutDays);
            
            const newProfile = {
                id: Date.now().toString(),
                name: wizardData.name,
                injury: wizardData.injury,
                workoutDays: wizardData.workoutDays,
                split: wizardData.split,
                workoutData: generateWorkoutPlan(wizardData),
                completedWorkouts: {},
                createdAt: new Date().toISOString()
            };

            console.log('Generated workout plan:', newProfile.workoutData);
            
            profiles.push(newProfile);
            localStorage.setItem('profiles', JSON.stringify(profiles));

            closeSetupWizard();
            loadProfile(newProfile.id);
        }

        // Generate workout plan based on wizard data
        function generateWorkoutPlan(data) {
            const plan = {};
            const allDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

            // First, initialize ALL days as rest days
            allDays.forEach(day => {
                plan[day] = {
                    name: day.charAt(0).toUpperCase() + day.slice(1),
                    muscleGroup: 'Rest Day',
                    rest: true
                };
            });

            // Now overwrite workout days with actual workouts based on split
            if (data.split === 'body-part') {
                // Body part split (your original plan)
                const bodyPartPlan = {
                    day1: { muscleGroup: 'Chest & Triceps', exercises: getChestTricepsExercises() },
                    day2: { muscleGroup: 'Back & Biceps', exercises: getBackBicepsExercises() },
                    day3: { muscleGroup: data.injury === 'knee' ? 'Legs (ACL-Safe)' : 'Legs', exercises: getLegsExercises(data.injury) },
                    day4: { muscleGroup: 'Shoulders & Arms', exercises: getShouldersArmsExercises() },
                    day5: { muscleGroup: 'Full Body', exercises: getFullBodyExercises(data.injury) }
                };

                data.workoutDays.forEach((day, idx) => {
                    const workoutKey = `day${(idx % 5) + 1}`;
                    const originalWorkout = bodyPartPlan[workoutKey];
                    
                    plan[day] = {
                        name: day.charAt(0).toUpperCase() + day.slice(1),
                        ...originalWorkout,
                        rest: false,
                        workoutType: 'strength', // default type
                        originalWorkout: originalWorkout // store for switching back
                    };
                    
                    // Add cardio option for ANY legs day if knee injury (not just Wednesday)
                    if (data.injury === 'knee' && plan[day].muscleGroup && plan[day].muscleGroup.includes('Legs')) {
                        plan[day].mode = 'legs';
                        plan[day].legs = {
                            exercises: plan[day].exercises,
                            warning: '‚ö†Ô∏è Light weights only - ACL recovery'
                        };
                        plan[day].cardio = {
                            exercises: getCardioExercises(),
                            warning: '‚ö†Ô∏è Low-impact cardio - ACL friendly'
                        };
                        delete plan[day].exercises;
                    }
                });
            } else if (data.split === 'push-pull-legs') {
                const pplPlan = ['push', 'pull', 'legs'];
                data.workoutDays.forEach((day, idx) => {
                    const workout = pplPlan[idx % 3];
                    const muscleGroup = workout === 'push' ? 'Push (Chest, Shoulders, Triceps)' :
                                        workout === 'pull' ? 'Pull (Back, Biceps)' :
                                        data.injury === 'knee' ? 'Legs (Modified)' : 'Legs';
                    const exercises = workout === 'push' ? getPushExercises() :
                                      workout === 'pull' ? getPullExercises() :
                                      getLegsExercises(data.injury);
                    
                    plan[day] = {
                        name: day.charAt(0).toUpperCase() + day.slice(1),
                        muscleGroup: muscleGroup,
                        exercises: exercises,
                        rest: false,
                        workoutType: 'strength',
                        originalWorkout: { muscleGroup: muscleGroup, exercises: exercises }
                    };
                });
            } else if (data.split === 'upper-lower') {
                data.workoutDays.forEach((day, idx) => {
                    const isUpper = idx % 2 === 0;
                    const muscleGroup = isUpper ? 'Upper Body' : data.injury === 'knee' ? 'Lower Body (Modified)' : 'Lower Body';
                    const exercises = isUpper ? getUpperBodyExercises() : getLegsExercises(data.injury);
                    
                    plan[day] = {
                        name: day.charAt(0).toUpperCase() + day.slice(1),
                        muscleGroup: muscleGroup,
                        exercises: exercises,
                        rest: false,
                        workoutType: 'strength',
                        originalWorkout: { muscleGroup: muscleGroup, exercises: exercises }
                    };
                });
            } else {
                // Full body
                data.workoutDays.forEach(day => {
                    const exercises = getFullBodyExercises(data.injury);
                    plan[day] = {
                        name: day.charAt(0).toUpperCase() + day.slice(1),
                        muscleGroup: 'Full Body',
                        exercises: exercises,
                        rest: false,
                        workoutType: 'strength',
                        originalWorkout: { muscleGroup: 'Full Body', exercises: exercises }
                    };
                });
            }

            return plan;
        }

        // Exercise templates
        function getChestTricepsExercises() {
            return [
                { name: 'Bench Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Incline Dumbbell Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Cable Flyes', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Tricep Pushdowns', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Overhead Tricep Extension', sets: 3, reps: '10-12', weight: 0, favorite: false }
            ];
        }

        function getBackBicepsExercises() {
            return [
                { name: 'Pull-ups/Lat Pulldown', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Bent Over Rows', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Seated Cable Rows', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Barbell Curls', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Hammer Curls', sets: 3, reps: '10-12', weight: 0, favorite: false }
            ];
        }

        function getLegsExercises(injury) {
            if (injury === 'knee') {
                return [
                    { name: 'Bodyweight Squats', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Leg Curls (Light)', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Calf Raises', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Glute Bridges', sets: 3, reps: '10-12', weight: 0, favorite: false },
                    { name: 'Straight Leg Raises', sets: 3, reps: '10-12', weight: 0, favorite: false }
                ];
            }
            return [
                { name: 'Squats', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Romanian Deadlifts', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Leg Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Leg Curls', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Calf Raises', sets: 3, reps: '10-12', weight: 0, favorite: false }
            ];
        }

        function getShouldersArmsExercises() {
            return [
                { name: 'Overhead Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Lateral Raises', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Front Raises', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Face Pulls', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Dumbbell Shrugs', sets: 3, reps: '10-12', weight: 0, favorite: false }
            ];
        }

        function getCardioExercises() {
            return [
                { name: 'Stationary Bike', sets: 1, reps: '20-30 min', weight: 0, favorite: false },
                { name: 'Elliptical', sets: 1, reps: '20-30 min', weight: 0, favorite: false },
                { name: 'Swimming', sets: 1, reps: '20-30 min', weight: 0, favorite: false },
                { name: 'Walking/Light Jog', sets: 1, reps: '20-30 min', weight: 0, favorite: false },
                { name: 'Rowing Machine', sets: 1, reps: '15-20 min', weight: 0, favorite: false }
            ];
        }

        function getHIITExercises() {
            return [
                { name: 'Burpees', sets: 1, reps: '40 sec on / 20 sec off', weight: 0, favorite: false },
                { name: 'Mountain Climbers', sets: 1, reps: '40 sec on / 20 sec off', weight: 0, favorite: false },
                { name: 'Jump Squats', sets: 1, reps: '40 sec on / 20 sec off', weight: 0, favorite: false },
                { name: 'High Knees', sets: 1, reps: '40 sec on / 20 sec off', weight: 0, favorite: false },
                { name: 'Plank Jacks', sets: 1, reps: '40 sec on / 20 sec off', weight: 0, favorite: false },
                { name: 'Jump Lunges', sets: 1, reps: '40 sec on / 20 sec off', weight: 0, favorite: false },
                { name: 'Russian Twists', sets: 1, reps: '40 sec on / 20 sec off', weight: 0, favorite: false },
                { name: 'Box Jumps', sets: 1, reps: '40 sec on / 20 sec off', weight: 0, favorite: false }
            ];
        }

        function getCardioOptionsDetailed() {
            return [
                { name: 'Running (Outdoor/Treadmill)', sets: 1, reps: '30-45 min', weight: 0, favorite: false },
                { name: 'Cycling (Outdoor/Stationary)', sets: 1, reps: '30-60 min', weight: 0, favorite: false },
                { name: 'Swimming', sets: 1, reps: '30-45 min', weight: 0, favorite: false },
                { name: 'Rowing Machine', sets: 1, reps: '20-30 min', weight: 0, favorite: false },
                { name: 'Elliptical', sets: 1, reps: '30-45 min', weight: 0, favorite: false },
                { name: 'Stairmaster', sets: 1, reps: '20-30 min', weight: 0, favorite: false },
                { name: 'Jump Rope', sets: 1, reps: '15-20 min', weight: 0, favorite: false },
                { name: 'Walking (Brisk)', sets: 1, reps: '45-60 min', weight: 0, favorite: false }
            ];
        }

        function getPushExercises() {
            return [
                { name: 'Bench Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Overhead Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Incline Dumbbell Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Lateral Raises', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Tricep Dips', sets: 3, reps: '10-12', weight: 0, favorite: false }
            ];
        }

        function getPullExercises() {
            return [
                { name: 'Deadlifts', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Pull-ups', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Barbell Rows', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Face Pulls', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Bicep Curls', sets: 3, reps: '10-12', weight: 0, favorite: false }
            ];
        }

        function getUpperBodyExercises() {
            return [
                { name: 'Bench Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Bent Over Rows', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Overhead Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Pull-ups', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Bicep Curls', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Tricep Pushdowns', sets: 3, reps: '10-12', weight: 0, favorite: false }
            ];
        }

        function getFullBodyExercises(injury) {
            const exercises = [
                { name: 'Push-ups', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Dumbbell Rows', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Shoulder Press', sets: 3, reps: '10-12', weight: 0, favorite: false },
                { name: 'Plank', sets: 3, reps: '30-60s', weight: 0, favorite: false }
            ];
            
            if (injury === 'knee') {
                exercises.splice(2, 0, { name: 'Bodyweight Squats', sets: 3, reps: '10-12', weight: 0, favorite: false });
            } else {
                exercises.splice(2, 0, { name: 'Squats', sets: 3, reps: '10-12', weight: 0, favorite: false });
            }
            
            return exercises;
        }

        // Profile Selector
        function openProfileSelector() {
            const profileList = document.getElementById('profileList');
            profileList.innerHTML = profiles.map(profile => `
                <div class="profile-item ${profile.id === currentProfileId ? 'active' : ''}" onclick="selectProfile('${profile.id}')">
                    <div class="profile-info">
                        <div class="profile-name">${profile.name}</div>
                        <div class="profile-details">
                            ${profile.split === 'body-part' ? 'Body Part Split' :
                              profile.split === 'push-pull-legs' ? 'Push/Pull/Legs' :
                              profile.split === 'upper-lower' ? 'Upper/Lower' : 'Full Body'}
                            ${profile.injury !== 'none' ? ' ‚Ä¢ ' + profile.injury.charAt(0).toUpperCase() + profile.injury.slice(1) + ' injury' : ''}
                        </div>
                    </div>
                    ${profiles.length > 1 ? `<button class="delete-profile-btn" onclick="event.stopPropagation(); deleteProfile('${profile.id}')">Delete</button>` : ''}
                </div>
            `).join('');

            document.getElementById('profileSelector').classList.add('active');
        }

        function closeProfileSelector() {
            document.getElementById('profileSelector').classList.remove('active');
        }

        function selectProfile(profileId) {
            loadProfile(profileId);
            closeProfileSelector();
        }

        function deleteProfile(profileId) {
            if (!confirm('Are you sure you want to delete this profile?')) return;

            profiles = profiles.filter(p => p.id !== profileId);
            localStorage.setItem('profiles', JSON.stringify(profiles));

            if (currentProfileId === profileId) {
                if (profiles.length > 0) {
                    loadProfile(profiles[0].id);
                } else {
                    currentProfileId = null;
                    localStorage.removeItem('currentProfileId');
                    openSetupWizard();
                }
            }

            closeProfileSelector();
        }

        // Save profile data periodically
        function saveCurrentProfile() {
            const profile = profiles.find(p => p.id === currentProfileId);
            if (profile) {
                profile.workoutData = workoutData;
                profile.completedWorkouts = completedWorkouts;
                localStorage.setItem('profiles', JSON.stringify(profiles));
            }
        }

        // Render Weekly Schedule
        function renderWeeklySchedule() {
            const weekGrid = document.getElementById('weekGrid');
            weekGrid.innerHTML = '';

            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const today = new Date().toDateString();

            days.forEach(day => {
                const dayData = workoutData[day];
                const dateKey = getDateKey(new Date());
                const isCompleted = completedWorkouts[dateKey]?.[day];

                const card = document.createElement('div');
                card.className = `day-card ${dayData.rest ? 'rest' : ''} ${isCompleted ? 'completed' : ''}`;
                card.style.position = 'relative';
                card.onclick = (e) => {
                    if (!e.target.classList.contains('mode-option') && !e.target.classList.contains('workout-type-btn')) {
                        dayData.rest ? null : openWorkout(day);
                    }
                };

                // Handle dual mode for legs/cardio (if it exists on ANY day)
                let exercises = dayData.exercises;
                let muscleGroup = dayData.muscleGroup;
                let warning = dayData.warning;
                
                if (dayData.mode && (dayData.legs || dayData.cardio)) {
                    const mode = dayData.mode || 'legs';
                    exercises = dayData[mode].exercises;
                    warning = dayData[mode].warning;
                    muscleGroup = mode === 'legs' ? 'Legs (ACL-Safe)' : 'Cardio (ACL-Safe)';
                }

                // Add workout type badge
                let workoutTypeBadge = '';
                if (dayData.workoutType === 'hiit') {
                    workoutTypeBadge = '<span class="hiit-badge">HIIT</span>';
                } else if (dayData.workoutType === 'cardio') {
                    workoutTypeBadge = '<span class="cardio-badge">CARDIO</span>';
                }

                card.innerHTML = `
                    <div class="day-header">
                        <div class="day-name">${dayData.name} ${workoutTypeBadge}</div>
                        <div class="completion-badge ${isCompleted ? 'completed' : ''}">
                            ${isCompleted ? '‚úì' : ''}
                        </div>
                    </div>
                    <div class="muscle-group">${muscleGroup}</div>
                    ${dayData.mode && (dayData.legs || dayData.cardio) ? `
                        <div class="mode-toggle" onclick="event.stopPropagation()">
                            <button class="mode-option ${dayData.mode === 'legs' ? 'active' : ''}" onclick="switchMode('${day}', 'legs')">Legs</button>
                            <button class="mode-option ${dayData.mode === 'cardio' ? 'active' : ''}" onclick="switchMode('${day}', 'cardio')">Cardio</button>
                        </div>
                    ` : ''}
                    ${warning ? `<div style="color: var(--secondary); font-size: 0.9rem; margin-top: 10px;">${warning}</div>` : ''}
                    ${!dayData.rest ? `
                        <ul class="exercise-list">
                            ${exercises.slice(0, 3).map(ex => `<li class="exercise-item">${ex.name}</li>`).join('')}
                            ${exercises.length > 3 ? `<li class="exercise-item">+${exercises.length - 3} more</li>` : ''}
                        </ul>
                        <button class="workout-type-btn" onclick="event.stopPropagation(); openWorkoutTypeModal('${day}')" title="Change workout type">‚öôÔ∏è</button>
                    ` : '<p style="color: var(--gray); margin-top: 10px;">Recovery day - let your muscles rebuild</p>'}
                `;

                weekGrid.appendChild(card);
            });
        }

        // Open Workout Modal
        function openWorkout(day) {
            currentWorkout = day;
            isEditMode = false;
            const dayData = workoutData[day];
            
            // Handle dual mode for legs/cardio (if it exists on ANY day)
            let exercises = dayData.exercises;
            let muscleGroup = dayData.muscleGroup;
            
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                exercises = dayData[mode].exercises;
                muscleGroup = mode === 'legs' ? 'Legs (ACL-Safe)' : 'Cardio (ACL-Safe)';
            }
            
            document.getElementById('modalTitle').textContent = `${dayData.name} - ${muscleGroup}`;
            document.getElementById('editToggleBtn').textContent = 'Edit Workout';
            document.getElementById('editToggleBtn').classList.remove('active');
            document.getElementById('addExerciseSection').classList.remove('active');
            
            renderExercises();
            document.getElementById('workoutModal').classList.add('active');
        }

        // Render exercises with or without edit controls
        function renderExercises() {
            const dayData = workoutData[currentWorkout];
            let exercises = dayData.exercises;
            
            // Handle dual mode for ANY day (not just wednesday)
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                exercises = dayData[mode].exercises;
            }
            
            // Get last workout for this day
            const lastWorkout = getLastWorkout(currentWorkout);
            
            const modalExercises = document.getElementById('modalExercises');
            modalExercises.innerHTML = exercises.map((ex, idx) => {
                const lastExercise = lastWorkout?.exercises.find(e => e.name === ex.name);
                const lastWeight = lastExercise?.weight || 0;
                
                return `
                <div class="exercise-detail">
                    <div class="exercise-name">
                        <span>${ex.name}</span>
                        <button class="favorite-btn ${ex.favorite ? 'active' : ''}" onclick="toggleFavorite('${currentWorkout}', ${idx})">
                            ${ex.favorite ? '‚òÖ' : '‚òÜ'}
                        </button>
                    </div>
                    <div style="color: var(--gray); margin-bottom: 10px;">
                        ${ex.sets} sets √ó ${ex.reps} reps
                        ${lastWeight > 0 ? `<span class="last-weight"> ‚Ä¢ Last: ${lastWeight}lbs</span>` : ''}
                    </div>
                    
                    ${!isEditMode ? `
                        <div class="weight-input-container">
                            <span class="weight-label">Weight:</span>
                            <input type="number" 
                                   class="weight-input" 
                                   value="${ex.weight || lastWeight || ''}" 
                                   onchange="updateExerciseWeight(${idx}, this.value)"
                                   placeholder="lbs"
                                   step="5">
                            <span class="weight-label">lbs</span>
                        </div>
                        <div class="sets-tracker" id="sets-${idx}">
                            ${Array(ex.sets).fill(0).map((_, setIdx) => `
                                <div class="set-box" onclick="toggleSet(${idx}, ${setIdx})">
                                    Set ${setIdx + 1}
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="exercise-edit-controls active">
                            <input type="text" class="edit-input" value="${ex.name}" onchange="updateExerciseName(${idx}, this.value)" placeholder="Exercise name">
                            <input type="number" class="edit-input" style="max-width: 80px;" value="${ex.sets}" onchange="updateExerciseSets(${idx}, this.value)" min="1" placeholder="Sets">
                            <input type="text" class="edit-input" style="max-width: 100px;" value="${ex.reps}" onchange="updateExerciseReps(${idx}, this.value)" placeholder="Reps">
                            <button class="delete-exercise-btn" onclick="deleteExercise(${idx})">Delete</button>
                        </div>
                    `}
                </div>
            `}).join('');
        }

        // Get last workout for a specific day
        function getLastWorkout(day) {
            if (!completedWorkouts.workoutHistory) return null;
            
            // Find the most recent workout for this day
            const history = completedWorkouts.workoutHistory
                .filter(w => w.day === day)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            return history.length > 0 ? history[0] : null;
        }

        // Update exercise weight
        function updateExerciseWeight(idx, weight) {
            const weightValue = parseFloat(weight) || 0;
            const dayData = workoutData[currentWorkout];
            
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                dayData[mode].exercises[idx].weight = weightValue;
            } else {
                dayData.exercises[idx].weight = weightValue;
            }
        }

        // Toggle Edit Mode
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const editBtn = document.getElementById('editToggleBtn');
            const addSection = document.getElementById('addExerciseSection');
            
            if (isEditMode) {
                editBtn.textContent = 'Done Editing';
                editBtn.classList.add('active');
                addSection.classList.add('active');
            } else {
                editBtn.textContent = 'Edit Workout';
                editBtn.classList.remove('active');
                addSection.classList.remove('active');
                saveCurrentProfile();
            }
            
            renderExercises();
        }

        // Update exercise properties
        function updateExerciseName(idx, newName) {
            const dayData = workoutData[currentWorkout];
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                dayData[mode].exercises[idx].name = newName;
            } else {
                dayData.exercises[idx].name = newName;
            }
        }

        function updateExerciseSets(idx, newSets) {
            const sets = parseInt(newSets) || 3;
            const dayData = workoutData[currentWorkout];
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                dayData[mode].exercises[idx].sets = sets;
            } else {
                dayData.exercises[idx].sets = sets;
            }
            renderExercises();
        }

        function updateExerciseReps(idx, newReps) {
            const dayData = workoutData[currentWorkout];
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                dayData[mode].exercises[idx].reps = newReps;
            } else {
                dayData.exercises[idx].reps = newReps;
            }
        }

        // Delete exercise
        function deleteExercise(idx) {
            if (!confirm('Are you sure you want to delete this exercise?')) return;
            
            const dayData = workoutData[currentWorkout];
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                dayData[mode].exercises.splice(idx, 1);
            } else {
                dayData.exercises.splice(idx, 1);
            }
            
            renderExercises();
            saveCurrentProfile();
        }

        // Add new exercise
        function addExercise() {
            const name = document.getElementById('newExerciseName').value.trim();
            const sets = parseInt(document.getElementById('newExerciseSets').value) || 3;
            const reps = document.getElementById('newExerciseReps').value.trim() || '10-12';
            
            if (!name) {
                alert('Please enter an exercise name');
                return;
            }
            
            const newExercise = {
                name: name,
                sets: sets,
                reps: reps,
                weight: 0,
                favorite: false
            };
            
            const dayData = workoutData[currentWorkout];
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                dayData[mode].exercises.push(newExercise);
            } else {
                dayData.exercises.push(newExercise);
            }
            
            // Clear form
            document.getElementById('newExerciseName').value = '';
            document.getElementById('newExerciseSets').value = '3';
            document.getElementById('newExerciseReps').value = '10-12';
            
            renderExercises();
            saveCurrentProfile();
        }

        function cancelAddExercise() {
            document.getElementById('newExerciseName').value = '';
            document.getElementById('newExerciseSets').value = '3';
            document.getElementById('newExerciseReps').value = '10-12';
        }

        // Toggle Set Completion
        function toggleSet(exerciseIdx, setIdx) {
            const setBox = document.querySelectorAll(`#sets-${exerciseIdx} .set-box`)[setIdx];
            setBox.classList.toggle('completed');
        }

        // Toggle Favorite
        function toggleFavorite(day, exerciseIdx) {
            if (day === 'wednesday' && workoutData[day].mode) {
                const mode = workoutData[day].mode || 'legs';
                workoutData[day][mode].exercises[exerciseIdx].favorite = !workoutData[day][mode].exercises[exerciseIdx].favorite;
            } else {
                workoutData[day].exercises[exerciseIdx].favorite = !workoutData[day].exercises[exerciseIdx].favorite;
            }
            saveCurrentProfile();
            
            // Only update the favorite button, not the entire modal
            // This preserves the set completion state
            const exercises = day === 'wednesday' && workoutData[day].mode 
                ? workoutData[day][workoutData[day].mode || 'legs'].exercises 
                : workoutData[day].exercises;
            const isFavorite = exercises[exerciseIdx].favorite;
            
            // Find and update the specific favorite button
            const exerciseDetails = document.querySelectorAll('.exercise-detail');
            if (exerciseDetails[exerciseIdx]) {
                const favoriteBtn = exerciseDetails[exerciseIdx].querySelector('.favorite-btn');
                if (favoriteBtn) {
                    favoriteBtn.textContent = isFavorite ? '‚òÖ' : '‚òÜ';
                    if (isFavorite) {
                        favoriteBtn.classList.add('active');
                    } else {
                        favoriteBtn.classList.remove('active');
                    }
                }
            }
            
            renderFavorites();
        }

        // Complete Workout
        function completeWorkout() {
            // Get the appropriate date for this workout
            // If doing Monday workout, mark Monday; if doing Tuesday, mark Tuesday, etc.
            const workoutDate = getDateForWorkoutDay(currentWorkout);
            const dateKey = getDateKey(workoutDate);
            const dayData = workoutData[currentWorkout];
            
            // Get exercises and their logged weights
            let exercises = dayData.exercises;
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                exercises = dayData[mode].exercises;
            }
            
            // Collect workout data with weights
            const workoutLog = {
                day: currentWorkout,
                muscleGroup: dayData.muscleGroup,
                date: workoutDate.toISOString(),
                exercises: exercises.map(ex => ({
                    name: ex.name,
                    sets: ex.sets,
                    reps: ex.reps,
                    weight: ex.weight || 0
                }))
            };
            
            // Initialize workoutHistory if it doesn't exist
            if (!completedWorkouts.workoutHistory) {
                completedWorkouts.workoutHistory = [];
            }
            
            // Add to history
            completedWorkouts.workoutHistory.push(workoutLog);
            
            // Keep only last 100 workouts to prevent data bloat
            if (completedWorkouts.workoutHistory.length > 100) {
                completedWorkouts.workoutHistory = completedWorkouts.workoutHistory.slice(-100);
            }
            
            // Mark day as completed (for calendar)
            if (!completedWorkouts[dateKey]) {
                completedWorkouts[dateKey] = {};
            }
            completedWorkouts[dateKey][currentWorkout] = true;
            
            saveCurrentProfile();
            
            closeModal();
            renderWeeklySchedule();
            renderCalendar();
            updateStats();
        }

        // Get the calendar date for a workout day
        function getDateForWorkoutDay(workoutDay) {
            const today = new Date();
            const dayNames = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            const todayDayIndex = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            const workoutDayIndex = dayNames.indexOf(workoutDay.toLowerCase());
            
            // Calculate the date for this workout day in the current week
            const dayDifference = workoutDayIndex - todayDayIndex;
            
            // If the workout day is today or in the past this week, use that date
            // If it's in the future this week, use that future date
            const workoutDate = new Date(today);
            workoutDate.setDate(today.getDate() + dayDifference);
            
            return workoutDate;
        }

        // Close Modal
        function closeModal() {
            if (isEditMode) {
                saveCurrentProfile();
            }
            isEditMode = false;
            document.getElementById('workoutModal').classList.remove('active');
            renderWeeklySchedule(); // Refresh the schedule to show any changes
        }

        // Workout Type Modal Functions
        let currentWorkoutTypeDay = null;

        function openWorkoutTypeModal(day) {
            currentWorkoutTypeDay = day;
            const dayData = workoutData[day];
            document.getElementById('workoutTypeDayName').textContent = dayData.name;
            document.getElementById('workoutTypeModal').classList.add('active');
            
            // Highlight current workout type
            const currentType = dayData.workoutType || 'strength';
            document.querySelectorAll('.workout-type-option').forEach(opt => {
                opt.classList.remove('active');
            });
            const activeOption = document.querySelector(`.workout-type-option[onclick="switchWorkoutType('${currentType}')"]`);
            if (activeOption) {
                activeOption.classList.add('active');
            }
        }

        function closeWorkoutTypeModal() {
            document.getElementById('workoutTypeModal').classList.remove('active');
            currentWorkoutTypeDay = null;
        }

        function switchWorkoutType(type) {
            if (!currentWorkoutTypeDay) return;
            
            const dayData = workoutData[currentWorkoutTypeDay];
            
            // Store original workout if not already stored
            if (!dayData.originalWorkout && dayData.exercises) {
                dayData.originalWorkout = {
                    muscleGroup: dayData.muscleGroup,
                    exercises: JSON.parse(JSON.stringify(dayData.exercises))
                };
            }
            
            // Switch workout type
            if (type === 'strength') {
                // Restore original workout
                if (dayData.originalWorkout) {
                    dayData.muscleGroup = dayData.originalWorkout.muscleGroup;
                    dayData.exercises = JSON.parse(JSON.stringify(dayData.originalWorkout.exercises));
                }
                dayData.workoutType = 'strength';
                dayData.rest = false;
                
            } else if (type === 'hiit') {
                dayData.muscleGroup = 'HIIT Circuit';
                dayData.exercises = getHIITExercises();
                dayData.workoutType = 'hiit';
                dayData.rest = false;
                
            } else if (type === 'cardio') {
                dayData.muscleGroup = 'Cardio Session';
                dayData.exercises = getCardioOptionsDetailed();
                dayData.workoutType = 'cardio';
                dayData.rest = false;
                
            } else if (type === 'rest') {
                dayData.muscleGroup = 'Rest Day';
                dayData.workoutType = 'rest';
                dayData.rest = true;
            }
            
            saveCurrentProfile();
            closeWorkoutTypeModal();
            renderWeeklySchedule();
        }

        // Switch Tab
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-content`).classList.add('active');

            if (tabName === 'calendar') {
                renderCalendar();
            } else if (tabName === 'favorites') {
                renderFavorites();
            } else if (tabName === 'history') {
                renderHistory();
            }
        }

        // Render Calendar
        function renderCalendar() {
            const month = currentDate.getMonth();
            const year = currentDate.getFullYear();
            
            document.getElementById('calendarMonth').textContent = 
                new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            // Day labels
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                const label = document.createElement('div');
                label.className = 'calendar-day-label';
                label.textContent = day;
                calendarGrid.appendChild(label);
            });

            // Empty cells before first day
            for (let i = 0; i < firstDay; i++) {
                calendarGrid.appendChild(document.createElement('div'));
            }

            // Calendar days
            let monthWorkoutCount = 0;

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateKey = getDateKey(date);
                const dayWorkouts = completedWorkouts[dateKey];
                const hasWorkout = dayWorkouts && Object.keys(dayWorkouts).filter(k => k !== 'workoutHistory').length > 0;
                
                if (hasWorkout) monthWorkoutCount++;

                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.textContent = day;
                dayEl.style.position = 'relative';
                
                if (hasWorkout) {
                    dayEl.classList.add('workout-day', 'clickable');
                    const workoutCount = Object.keys(dayWorkouts).filter(k => k !== 'workoutHistory').length;
                    dayEl.title = `Click to view ${workoutCount} workout(s)`;
                    dayEl.onclick = () => showDayDetail(date, dayWorkouts);
                }

                calendarGrid.appendChild(dayEl);
            }

            // Update monthly goal progress
            updateGoalProgress(monthWorkoutCount);
        }

        // Update monthly goal progress
        function updateGoalProgress(currentCount) {
            const goal = parseInt(document.getElementById('monthlyGoal').value) || 20;
            const percentage = Math.min(Math.round((currentCount / goal) * 100), 100);
            
            document.getElementById('goalProgress').textContent = `${currentCount} / ${goal}`;
            document.getElementById('goalPercentage').textContent = `${percentage}%`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
            
            if (percentage >= 10) {
                document.getElementById('progressBarText').textContent = `${percentage}%`;
            } else {
                document.getElementById('progressBarText').textContent = '';
            }

            // Progress message
            const messageEl = document.getElementById('progressMessage');
            if (currentCount >= goal) {
                messageEl.textContent = 'üî• Goal Crushed! Amazing work!';
                messageEl.className = 'progress-message crushing';
            } else if (percentage >= 80) {
                messageEl.textContent = 'üí™ Almost there! Keep pushing!';
                messageEl.className = 'progress-message on-track';
            } else if (percentage >= 50) {
                messageEl.textContent = '‚úÖ On track! Stay consistent!';
                messageEl.className = 'progress-message on-track';
            } else if (currentCount > 0) {
                messageEl.textContent = 'üìà Keep going! Every workout counts!';
                messageEl.className = 'progress-message behind';
            } else {
                messageEl.textContent = 'üéØ Start your journey today!';
                messageEl.className = 'progress-message';
            }
        }

        // Show day detail when calendar day is clicked
        function showDayDetail(date, dayWorkouts) {
            const detailContainer = document.getElementById('calendarDayDetail');
            const dateStr = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric',
                year: 'numeric'
            });

            // Get workout history for this specific date
            const dateKey = getDateKey(date);
            const workoutsOnDate = completedWorkouts.workoutHistory
                ? completedWorkouts.workoutHistory.filter(w => getDateKey(new Date(w.date)) === dateKey)
                : [];

            let detailHTML = `
                <div class="calendar-day-detail">
                    <div class="day-detail-header">${dateStr}</div>
            `;

            if (workoutsOnDate.length > 0) {
                workoutsOnDate.forEach(workout => {
                    detailHTML += `
                        <div class="day-detail-workout">
                            <div class="day-detail-muscle">${workout.day.charAt(0).toUpperCase() + workout.day.slice(1)} - ${workout.muscleGroup}</div>
                            ${workout.exercises.map(ex => `
                                <div class="day-detail-exercise">
                                    <span>${ex.name}</span>
                                    <span style="color: var(--gray);">
                                        ${ex.sets} √ó ${ex.reps}
                                        ${ex.weight > 0 ? ` ‚Ä¢ <span style="color: var(--primary);">${ex.weight}lbs</span>` : ''}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                });
            } else {
                // Fallback for old data format (just showing day names)
                const workoutDays = Object.keys(dayWorkouts).filter(k => k !== 'workoutHistory');
                detailHTML += `
                    <div class="day-detail-workout">
                        <div class="day-detail-muscle">Workout completed</div>
                        <p style="color: var(--gray); font-size: 0.9rem;">
                            ${workoutDays.map(d => d.charAt(0).toUpperCase() + d.slice(1)).join(', ')}
                        </p>
                    </div>
                `;
            }

            detailHTML += `</div>`;
            detailContainer.innerHTML = detailHTML;
            
            // Scroll to detail
            detailContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Update monthly goal
        function updateMonthlyGoal() {
            const goal = parseInt(document.getElementById('monthlyGoal').value) || 20;
            monthlyGoal = goal;
            
            // Save to profile
            const profile = profiles.find(p => p.id === currentProfileId);
            if (profile) {
                profile.monthlyGoal = goal;
                localStorage.setItem('profiles', JSON.stringify(profiles));
            }
            
            renderCalendar();
        }

        // Change Month
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar();
        }

        // Render Favorites
        function renderFavorites() {
            const favoritesGrid = document.getElementById('favoritesGrid');
            const favorites = [];

            Object.keys(workoutData).forEach(day => {
                if (day === 'wednesday') {
                    // Handle both modes for Wednesday
                    ['legs', 'cardio'].forEach(mode => {
                        if (workoutData[day][mode] && workoutData[day][mode].exercises) {
                            workoutData[day][mode].exercises.forEach((ex, idx) => {
                                if (ex.favorite) {
                                    favorites.push({ 
                                        day, 
                                        exercise: ex, 
                                        idx,
                                        muscleGroup: mode === 'legs' ? 'Legs (ACL-Safe)' : 'Cardio (ACL-Safe)'
                                    });
                                }
                            });
                        }
                    });
                } else if (workoutData[day].exercises) {
                    workoutData[day].exercises.forEach((ex, idx) => {
                        if (ex.favorite) {
                            favorites.push({ 
                                day, 
                                exercise: ex, 
                                idx,
                                muscleGroup: workoutData[day].muscleGroup
                            });
                        }
                    });
                }
            });

            if (favorites.length === 0) {
                favoritesGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚òÖ</div>
                        <p>No favorite exercises yet</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Click the star icon on any exercise to add it to favorites</p>
                    </div>
                `;
                return;
            }

            favoritesGrid.innerHTML = favorites.map(fav => `
                <div class="favorite-card">
                    <div class="favorite-header">
                        <div class="favorite-name">${fav.exercise.name}</div>
                        <button class="remove-favorite" onclick="toggleFavorite('${fav.day}', ${fav.idx})">√ó</button>
                    </div>
                    <div style="color: var(--gray); font-size: 0.9rem;">
                        ${fav.muscleGroup}
                    </div>
                    <div style="color: var(--gray); font-size: 0.9rem; margin-top: 5px;">
                        ${fav.exercise.sets} sets √ó ${fav.exercise.reps} reps
                    </div>
                </div>
            `).join('');
        }

        // Render Workout History
        function renderHistory() {
            const historyContainer = document.getElementById('historyContainer');
            
            if (!completedWorkouts.workoutHistory || completedWorkouts.workoutHistory.length === 0) {
                historyContainer.innerHTML = `
                    <div class="history-section">
                        <div class="no-history">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üìä</div>
                            <p>No workout history yet</p>
                            <p style="font-size: 0.9rem; margin-top: 10px;">Complete your first workout to start tracking your progress!</p>
                        </div>
                    </div>
                `;
                return;
            }

            // Group workouts by date
            const workoutsByDate = {};
            completedWorkouts.workoutHistory
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .forEach(workout => {
                    const date = new Date(workout.date).toLocaleDateString('en-US', { 
                        weekday: 'short', 
                        month: 'short', 
                        day: 'numeric',
                        year: 'numeric'
                    });
                    if (!workoutsByDate[date]) {
                        workoutsByDate[date] = [];
                    }
                    workoutsByDate[date].push(workout);
                });

            historyContainer.innerHTML = `
                <div class="history-section">
                    <div class="history-title">
                        <span>Workout History</span>
                        <span style="color: var(--gray); font-size: 0.9rem; font-weight: 400;">
                            ${completedWorkouts.workoutHistory.length} total workouts
                        </span>
                    </div>
                    ${Object.entries(workoutsByDate).map(([date, workouts]) => `
                        <div style="margin-bottom: 25px;">
                            <div class="history-date">${date}</div>
                            ${workouts.map(workout => `
                                <div class="history-entry">
                                    <div style="font-weight: 700; margin-bottom: 10px; color: var(--primary);">
                                        ${workout.day.charAt(0).toUpperCase() + workout.day.slice(1)} - ${workout.muscleGroup}
                                    </div>
                                    ${workout.exercises.map(ex => `
                                        <div class="history-exercise">
                                            <span class="history-exercise-name">${ex.name}</span>
                                            <span class="history-sets">${ex.sets} √ó ${ex.reps}</span>
                                            ${ex.weight > 0 ? `<span class="history-weight">${ex.weight}lbs</span>` : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Update Stats
        function updateStats() {
            const now = new Date();
            const monthKey = `${now.getFullYear()}-${now.getMonth()}`;
            
            let monthWorkouts = 0;
            Object.keys(completedWorkouts).forEach(dateKey => {
                const date = new Date(dateKey);
                if (`${date.getFullYear()}-${date.getMonth()}` === monthKey) {
                    monthWorkouts += Object.keys(completedWorkouts[dateKey]).length;
                }
            });

            document.getElementById('monthWorkouts').textContent = monthWorkouts;

            // Calculate streak
            let streak = 0;
            let checkDate = new Date();
            while (true) {
                const dateKey = getDateKey(checkDate);
                if (completedWorkouts[dateKey] && Object.keys(completedWorkouts[dateKey]).length > 0) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            document.getElementById('currentStreak').textContent = streak;

            // Completion rate
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const completionRate = monthWorkouts > 0 ? Math.round((monthWorkouts / (daysInMonth * 0.8)) * 100) : 0;
            document.getElementById('completionRate').textContent = completionRate + '%';
        }

        // Switch Wednesday Mode
        // Workout Reorder Functions
        let reorderWorkoutDays = [];

        function openReorderModal() {
            // Get current workout days (non-rest days)
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            reorderWorkoutDays = days.filter(day => !workoutData[day].rest);
            
            renderReorderList();
            document.getElementById('reorderModal').classList.add('active');
        }

        function closeReorderModal() {
            document.getElementById('reorderModal').classList.remove('active');
            reorderWorkoutDays = [];
        }

        function renderReorderList() {
            const reorderList = document.getElementById('reorderList');
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            // Get only the workout days (non-rest)
            const workoutDaysInfo = [];
            days.forEach(day => {
                if (!workoutData[day].rest) {
                    workoutDaysInfo.push({
                        dayName: day,
                        displayDay: workoutData[day].name
                    });
                }
            });
            
            reorderList.innerHTML = reorderWorkoutDays.map((workoutDay, idx) => {
                const dayData = workoutData[workoutDay];
                let workoutType = dayData.muscleGroup;
                if (dayData.workoutType === 'hiit') workoutType += ' (HIIT)';
                if (dayData.workoutType === 'cardio') workoutType += ' (Cardio)';
                
                const assignedTo = workoutDaysInfo[idx].displayDay;
                
                return `
                    <div class="reorder-item" draggable="true" data-index="${idx}">
                        <div class="reorder-handle">‚ò∞</div>
                        <div class="reorder-info">
                            <div class="reorder-day-name">${assignedTo}: ${workoutType}</div>
                            <div class="reorder-workout-type">Currently assigned to ${assignedTo}</div>
                        </div>
                        <div class="reorder-controls">
                            <button class="reorder-btn" onclick="moveWorkoutUp(${idx})" ${idx === 0 ? 'disabled' : ''}>‚Üë</button>
                            <button class="reorder-btn" onclick="moveWorkoutDown(${idx})" ${idx === reorderWorkoutDays.length - 1 ? 'disabled' : ''}>‚Üì</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add drag and drop event listeners
            const items = reorderList.querySelectorAll('.reorder-item');
            items.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);
            });
        }

        function moveWorkoutUp(idx) {
            if (idx === 0) return;
            [reorderWorkoutDays[idx], reorderWorkoutDays[idx - 1]] = [reorderWorkoutDays[idx - 1], reorderWorkoutDays[idx]];
            renderReorderList();
        }

        function moveWorkoutDown(idx) {
            if (idx === reorderWorkoutDays.length - 1) return;
            [reorderWorkoutDays[idx], reorderWorkoutDays[idx + 1]] = [reorderWorkoutDays[idx + 1], reorderWorkoutDays[idx]];
            renderReorderList();
        }

        // Drag and Drop handlers
        let draggedIndex = null;

        function handleDragStart(e) {
            draggedIndex = parseInt(e.target.dataset.index);
            e.target.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const dropIndex = parseInt(e.target.closest('.reorder-item').dataset.index);
            
            if (draggedIndex !== null && draggedIndex !== dropIndex) {
                // Swap the items
                const draggedDay = reorderWorkoutDays[draggedIndex];
                reorderWorkoutDays.splice(draggedIndex, 1);
                reorderWorkoutDays.splice(dropIndex, 0, draggedDay);
                renderReorderList();
            }
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedIndex = null;
        }

        function applyReorder() {
            // Create a new workout plan with reordered workouts
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const newWorkoutData = {};
            
            // First, copy over rest days
            days.forEach(day => {
                if (workoutData[day].rest) {
                    newWorkoutData[day] = workoutData[day];
                }
            });
            
            // Then, assign reordered workouts to the original workout days
            let workoutIdx = 0;
            days.forEach(day => {
                if (!workoutData[day].rest) {
                    const sourceDay = reorderWorkoutDays[workoutIdx];
                    newWorkoutData[day] = {
                        ...workoutData[sourceDay],
                        name: day.charAt(0).toUpperCase() + day.slice(1)
                    };
                    workoutIdx++;
                }
            });
            
            // Update the workout data
            workoutData = newWorkoutData;
            
            // Save to profile
            const profile = profiles.find(p => p.id === currentProfileId);
            if (profile) {
                profile.workoutData = workoutData;
                localStorage.setItem('profiles', JSON.stringify(profiles));
            }
            
            closeReorderModal();
            renderWeeklySchedule();
        }

        // Switch between legs and cardio mode for dual-mode days
        function switchMode(day, mode) {
            if (workoutData[day] && workoutData[day].mode !== undefined) {
                workoutData[day].mode = mode;
                saveCurrentProfile();
                renderWeeklySchedule();
            }
        }

        // Quick Actions Functions
        function toggleQuickActions() {
            const btn = document.getElementById('quickActionsBtn');
            const menu = document.getElementById('quickActionsMenu');
            btn.classList.toggle('active');
            menu.classList.toggle('active');
        }

        function closeQuickActions() {
            const btn = document.getElementById('quickActionsBtn');
            const menu = document.getElementById('quickActionsMenu');
            btn.classList.remove('active');
            menu.classList.remove('active');
        }

        function quickLogToday() {
            closeQuickActions();
            const today = new Date();
            openQuickLogModal(today);
        }

        function quickLogYesterday() {
            closeQuickActions();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            openQuickLogModal(yesterday);
        }

        let selectedQuickLogDay = null;

        function openQuickLogModal(date) {
            selectedQuickLogDay = null;
            
            const dateStr = date.toISOString().split('T')[0];
            document.getElementById('quickLogDate').value = dateStr;
            
            updateQuickLogDateDisplay();
            renderQuickLogWorkouts();
            
            document.getElementById('quickLogModal').classList.add('active');
        }

        function updateQuickLogDateDisplay() {
            const dateStr = document.getElementById('quickLogDate').value;
            const date = new Date(dateStr + 'T12:00:00');
            const dateDisplay = date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
            document.getElementById('quickLogDateDisplay').textContent = dateDisplay;
            
            // Update title
            document.getElementById('quickLogTitle').textContent = `Log Workout`;
        }

        function adjustQuickLogDate(days) {
            const currentDate = new Date(document.getElementById('quickLogDate').value + 'T12:00:00');
            currentDate.setDate(currentDate.getDate() + days);
            document.getElementById('quickLogDate').value = currentDate.toISOString().split('T')[0];
            updateQuickLogDateDisplay();
        }

        function renderQuickLogWorkouts() {
            // Show all non-rest workouts
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const workouts = days.filter(day => !workoutData[day].rest);
            
            const grid = document.getElementById('quickLogGrid');
            grid.innerHTML = workouts.map(day => {
                const dayData = workoutData[day];
                let muscleGroup = dayData.muscleGroup;
                
                // Handle dual mode
                if (dayData.mode && (dayData.legs || dayData.cardio)) {
                    const mode = dayData.mode || 'legs';
                    muscleGroup = mode === 'legs' ? 'Legs (ACL-Safe)' : 'Cardio (ACL-Safe)';
                }
                
                // Add workout type badge
                let badge = '';
                if (dayData.workoutType === 'hiit') badge = ' üî•';
                if (dayData.workoutType === 'cardio') badge = ' üèÉ';
                
                const isSelected = selectedQuickLogDay === day;
                
                return `
                    <div class="quick-log-day ${isSelected ? 'active' : ''}" onclick="selectQuickLogWorkout('${day}')" style="${isSelected ? 'border-color: var(--primary); background: rgba(255, 107, 53, 0.2);' : ''}">
                        <div class="quick-log-day-name">${dayData.name}${badge}</div>
                        <div class="quick-log-workout">${muscleGroup}</div>
                    </div>
                `;
            }).join('');
        }

        function selectQuickLogWorkout(day) {
            selectedQuickLogDay = day;
            
            // Auto-adjust date to match the selected day
            const dayNames = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            const targetDayIndex = dayNames.indexOf(day);
            
            const currentDate = new Date(document.getElementById('quickLogDate').value + 'T12:00:00');
            const currentDayIndex = currentDate.getDay();
            
            // Calculate how many days to adjust (prefer most recent occurrence)
            let daysToAdjust = targetDayIndex - currentDayIndex;
            if (daysToAdjust > 0) {
                // Target day is in the future this week, go back to last week
                daysToAdjust -= 7;
            }
            
            currentDate.setDate(currentDate.getDate() + daysToAdjust);
            document.getElementById('quickLogDate').value = currentDate.toISOString().split('T')[0];
            updateQuickLogDateDisplay();
            
            // Re-render to show selection
            renderQuickLogWorkouts();
            
            // Show selected workout details
            const dayData = workoutData[day];
            let muscleGroup = dayData.muscleGroup;
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                muscleGroup = mode === 'legs' ? 'Legs (ACL-Safe)' : 'Cardio (ACL-Safe)';
            }
            
            document.getElementById('quickLogSelectedWorkout').innerHTML = `
                <div style="color: var(--primary); font-weight: 700; margin-bottom: 8px;">Selected:</div>
                <div style="font-size: 1.1rem; font-weight: 700;">${dayData.name} - ${muscleGroup}</div>
                <div style="color: var(--gray); font-size: 0.9rem; margin-top: 5px;">
                    Will be logged for ${new Date(document.getElementById('quickLogDate').value + 'T12:00:00').toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}
                </div>
            `;
            
            // Enable confirm button
            document.getElementById('quickLogConfirmBtn').disabled = false;
        }

        function confirmQuickLog() {
            if (!selectedQuickLogDay) return;
            
            const dateStr = document.getElementById('quickLogDate').value;
            quickCompleteWorkout(selectedQuickLogDay, dateStr);
        }

        function closeQuickLogModal() {
            document.getElementById('quickLogModal').classList.remove('active');
            selectedQuickLogDay = null;
            document.getElementById('quickLogSelectedWorkout').innerHTML = '';
            document.getElementById('quickLogConfirmBtn').disabled = true;
        }

        function quickCompleteWorkout(day, dateStr) {
            const dayData = workoutData[day];
            
            // Get exercises
            let exercises = dayData.exercises;
            if (dayData.mode && (dayData.legs || dayData.cardio)) {
                const mode = dayData.mode || 'legs';
                exercises = dayData[mode].exercises;
            }
            
            // Parse the date string to create proper Date object
            const workoutDate = new Date(dateStr + 'T12:00:00'); // Add time to avoid timezone issues
            
            // Create workout log
            const workoutLog = {
                day: day,
                muscleGroup: dayData.muscleGroup,
                date: workoutDate.toISOString(),
                exercises: exercises.map(ex => ({
                    name: ex.name,
                    sets: ex.sets,
                    reps: ex.reps,
                    weight: ex.weight || 0
                }))
            };
            
            // Add to history
            if (!completedWorkouts.workoutHistory) {
                completedWorkouts.workoutHistory = [];
            }
            completedWorkouts.workoutHistory.push(workoutLog);
            
            // Keep only last 100 workouts
            if (completedWorkouts.workoutHistory.length > 100) {
                completedWorkouts.workoutHistory = completedWorkouts.workoutHistory.slice(-100);
            }
            
            // Mark day as completed using proper dateKey format
            const dateKey = getDateKey(workoutDate);
            if (!completedWorkouts[dateKey]) {
                completedWorkouts[dateKey] = {};
            }
            completedWorkouts[dateKey][day] = true;
            
            saveCurrentProfile();
            closeQuickLogModal();
            renderWeeklySchedule();
            renderCalendar();
            updateStats();
            
            // Show success message
            alert(`‚úÖ ${dayData.name} workout logged for ${workoutDate.toLocaleDateString()}!`);
        }

        function openSkipWorkoutModal() {
            closeQuickActions();
            const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });
            if (confirm(`Skip today's workout (${today})?\n\nThis won't count as a completed workout, but won't break your streak either.`)) {
                alert('Workout skipped. Rest up and come back stronger! üí™');
            }
        }

        function openCustomWorkoutModal() {
            closeQuickActions();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('customWorkoutDate').value = today;
            document.getElementById('customWorkoutName').value = '';
            document.getElementById('customWorkoutNotes').value = '';
            document.getElementById('customWorkoutModal').classList.add('active');
        }

        function closeCustomWorkoutModal() {
            document.getElementById('customWorkoutModal').classList.remove('active');
        }

        function saveCustomWorkout() {
            const dateStr = document.getElementById('customWorkoutDate').value;
            const name = document.getElementById('customWorkoutName').value.trim();
            const notes = document.getElementById('customWorkoutNotes').value.trim();
            
            if (!name) {
                alert('Please enter a workout name');
                return;
            }
            
            // Parse the date string to create proper Date object
            const workoutDate = new Date(dateStr + 'T12:00:00'); // Add time to avoid timezone issues
            
            // Create custom workout log
            const workoutLog = {
                day: 'custom',
                muscleGroup: name,
                date: workoutDate.toISOString(),
                exercises: [{
                    name: notes || 'Custom workout',
                    sets: 1,
                    reps: 'Completed',
                    weight: 0
                }]
            };
            
            // Add to history
            if (!completedWorkouts.workoutHistory) {
                completedWorkouts.workoutHistory = [];
            }
            completedWorkouts.workoutHistory.push(workoutLog);
            
            // Keep only last 100 workouts
            if (completedWorkouts.workoutHistory.length > 100) {
                completedWorkouts.workoutHistory = completedWorkouts.workoutHistory.slice(-100);
            }
            
            // Mark in calendar using proper dateKey format
            const dateKey = getDateKey(workoutDate);
            if (!completedWorkouts[dateKey]) {
                completedWorkouts[dateKey] = {};
            }
            completedWorkouts[dateKey]['custom'] = true;
            
            saveCurrentProfile();
            closeCustomWorkoutModal();
            renderCalendar();
            updateStats();
            
            alert(`‚úÖ Custom workout "${name}" logged!`);
        }

        // Helper function
        function getDateKey(date) {
            // Use local date components to avoid timezone issues
            // toISOString() uses UTC which can cause off-by-one day errors
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Initialize app
        init();

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // You could show a custom install button here
        });
    </script>
</body>
</html>
